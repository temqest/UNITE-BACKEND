  console.log
    [dotenv@17.2.3] injecting env (12) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (12) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (12) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (12) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (12) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    SendGrid API initialized

      at new log (src/services/utility_services/email.service.js:8:13)

  console.log
    SendGrid API initialized

      at new log (src/services/utility_services/email.service.js:8:13)

  console.log
    SendGrid API initialized

      at new log (src/services/utility_services/email.service.js:8:13)

  console.log
    SendGrid API initialized

      at new log (src/services/utility_services/email.service.js:8:13)

  console.log
    SendGrid API initialized

      at new log (src/services/utility_services/email.service.js:8:13)

(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"Request_ID":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:29784) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"Request_ID":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:25520) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"Request_ID":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:1816) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"Request_ID":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:17436) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"email":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"authority":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"Request_ID":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:26868) [MONGOOSE] Warning: Duplicate schema index on {"code":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    ‚úÖ Test database connected

      at Object.log (tests/setup/testSetup.js:27:13)

  console.log
    ‚úÖ Test database connected

      at Object.log (tests/setup/testSetup.js:27:13)

  console.log
    [TEST] Flow: Stakeholder ‚Üí Coordinator

      at TestLogger.log [as logFlowStart] (tests/helpers/logger.js:17:13)

  console.log
    [TEST] Flow: Coordinator ‚Üí Admin

      at TestLogger.log [as logFlowStart] (tests/helpers/logger.js:17:13)

  console.log
    ‚úÖ Test database connected

      at Object.log (tests/setup/testSetup.js:27:13)

  console.log
    [TEST] Flow: Request Lifecycle

      at TestLogger.log [as logFlowStart] (tests/helpers/logger.js:17:13)

  console.log
    ‚úÖ Test database connected

      at Object.log (tests/setup/testSetup.js:27:13)

  console.log
    [TEST] Flow: Coordinator ‚Üî Stakeholder Bidirectional

      at TestLogger.log [as logFlowStart] (tests/helpers/logger.js:17:13)

  console.log
    ‚úÖ Test database connected

      at Object.log (tests/setup/testSetup.js:27:13)

  console.log
    [TEST] Flow: Admin ‚Üí Coordinator

      at TestLogger.log [as logFlowStart] (tests/helpers/logger.js:17:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694aacb51d6c212ee3037d0f, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [ASSERT] PASS: User authority is 30

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Testing complete accept ‚Üí publish flow

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:19.095Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: User authority is 60

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ASSERT] PASS: User authority is 60

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator',
        description: 'Event and request coordinator with review and approval capabilities',
        isSystemRole: true,
        authority: 60,
        permissions: [
          [Object], [Object],
          [Object], [Object],
          [Object], [Object],
          [Object], [Object]
        ],
        createdAt: 2025-12-23T14:22:56.199Z,
        updatedAt: 2025-12-26T07:43:26.510Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleCode: 'coordinator',
      roleName: 'Coordinator',
      hasPermissions: true,
      permissionsLength: 8
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 8 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: patrickkurtv@gmail.com | Authority: 60 | Permissions: [[object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    [ACTION] Creating request as coordinator with stakeholder reference

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [ASSERT] PASS: User authority is 100

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    üì• 2025-12-26T07:55:20.001Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694d7a98e94478ff31e0c1fd, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694d7a98e94478ff31e0c1fd

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694d7a98e94478ff31e0c1fd, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [ASSERT] PASS: User authority is 100

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694aacb51d6c212ee3037d0f, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [ASSERT] PASS: User authority is 100

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a274d'),
        code: 'stakeholder',
        name: 'Stakeholder',
        description: 'Stakeholder with event creation and request confirmation capabilities',
        isSystemRole: true,
        authority: 30,
        permissions: [ [Object], [Object], [Object], [Object], [Object] ],
        createdAt: 2025-12-23T14:22:56.282Z,
        updatedAt: 2025-12-26T07:43:26.676Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleCode: 'stakeholder',
      roleName: 'Stakeholder',
      hasPermissions: true,
      permissionsLength: 5
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 5 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: jpetalio@gmail.com | Authority: 30 | Permissions: [[object Object], [object Object], [object Object], [object Object], [object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.create: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Creating request as stakeholder

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:21.048Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: User authority is 60

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694aa6556e0113b3849a3e42, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator',
        description: 'Event and request coordinator with review and approval capabilities',
        isSystemRole: true,
        authority: 60,
        permissions: [
          [Object], [Object],
          [Object], [Object],
          [Object], [Object],
          [Object], [Object]
        ],
        createdAt: 2025-12-23T14:22:56.199Z,
        updatedAt: 2025-12-26T07:43:26.510Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleCode: 'coordinator',
      roleName: 'Coordinator',
      hasPermissions: true,
      permissionsLength: 8
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 8 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: patrickkurtv@gmail.com | Authority: 60 | Permissions: [[object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.create: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [ACTION] Creating request as coordinator

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:22.000Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUserRoles called with userId: 694aa6556e0113b3849a3e42, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator',
        description: 'Full system access with all permissions',
        isSystemRole: true,
        authority: 100,
        permissions: [ [Object] ],
        createdAt: 2025-12-23T14:22:56.122Z,
        updatedAt: 2025-12-26T07:43:26.341Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleCode: 'system-admin',
      roleName: 'System Administrator',
      hasPermissions: true,
      permissionsLength: 1
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [system-admin]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 1 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: admin@example.com | Authority: 100 | Permissions: [[object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ROUTING] Request assigned to: admin@example.com (Authority: 100)

      at TestLogger.log [as logRouting] (tests/helpers/logger.js:52:13)

  console.log
    [RESULT] Coordinator request with stakeholder reference created successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694d7a98e94478ff31e0c1fd, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694d7a98e94478ff31e0c1fd

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694d7a98e94478ff31e0c1fd, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a274d'),
        code: 'stakeholder',
        name: 'Stakeholder',
        description: 'Stakeholder with event creation and request confirmation capabilities',
        isSystemRole: true,
        authority: 30,
        permissions: [ [Object], [Object], [Object], [Object], [Object] ],
        createdAt: 2025-12-23T14:22:56.282Z,
        updatedAt: 2025-12-26T07:43:26.676Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleCode: 'stakeholder',
      roleName: 'Stakeholder',
      hasPermissions: true,
      permissionsLength: 5
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 5 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: jpetalio@gmail.com | Authority: 30 | Permissions: [[object Object], [object Object], [object Object], [object Object], [object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    [ACTION] Creating request as stakeholder (should escalate to coordinator)

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:23.087Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.create: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Creating request as admin with coordinator selection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:23.793Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [requirePermission] SysAdmin bypass: {
      userId: '694aa6556e0113b3849a3e42',
      authority: 100,
      resource: 'request',
      action: 'create'
    }

      at log (src/middleware/requirePermission.js:26:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [ACTION] Created request REQ-1766735723942-2838

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ASSERT] PASS: Request routed to reviewer 694aacb51d6c212ee3037d0f

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] initial ‚Üí pending-review

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Coordinator accepting

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:24.043Z - POST /api/event-requests/REQ-1766735723946-3581/actions

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.review: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [ASSERT] PASS: Authority hierarchy valid (reviewer: 60 >= requester: 30)

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ROUTING] Request assigned to: patrickkurtv@gmail.com (Authority: 60)

      at TestLogger.log [as logRouting] (tests/helpers/logger.js:52:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUserRoles called with userId: 694aa6556e0113b3849a3e42, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [ASSERT] PASS: Authority hierarchy valid (reviewer: 60 >= requester: 30)

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Stakeholder request escalated to coordinator successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing multiple reschedule iterations

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:24.807Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [ASSERT] PASS: Organization/coverage area match exists

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Request created and routed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694aacb51d6c212ee3037d0f, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [system-admin]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator',
        description: 'Event and request coordinator with review and approval capabilities',
        isSystemRole: true,
        authority: 60,
        permissions: [
          [Object], [Object],
          [Object], [Object],
          [Object], [Object],
          [Object], [Object]
        ],
        createdAt: 2025-12-23T14:22:56.199Z,
        updatedAt: 2025-12-26T07:43:26.510Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleCode: 'coordinator',
      roleName: 'Coordinator',
      hasPermissions: true,
      permissionsLength: 8
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Aggregated 8 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: patrickkurtv@gmail.com | Authority: 60 | Permissions: [[object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ACTION] Created request REQ-1766735724912-1269

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:25.009Z - GET /api/event-requests/REQ-1766735723942-2838

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [ASSERT] PASS: Request state is review-accepted

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-accepted

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Stakeholder confirming

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:25.081Z - POST /api/event-requests/REQ-1766735723946-3581/actions

      at log (server.js:142:13)

  console.log
    [ROUTING] Request assigned to: admin@example.com (Authority: 100)

      at TestLogger.log [as logRouting] (tests/helpers/logger.js:52:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.review: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [ACTION] First reschedule by coordinator

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:25.345Z - POST /api/event-requests/REQ-1766735725301-3065/actions

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Authority hierarchy valid (reviewer: 100 >= requester: 60)

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Request created and routed to admin successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694aa6556e0113b3849a3e42, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:25.431Z - GET /api/event-requests/REQ-1766735723942-2838/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator',
        description: 'Full system access with all permissions',
        isSystemRole: true,
        authority: 100,
        permissions: [ [Object] ],
        createdAt: 2025-12-23T14:22:56.122Z,
        updatedAt: 2025-12-26T07:43:26.341Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleCode: 'system-admin',
      roleName: 'System Administrator',
      hasPermissions: true,
      permissionsLength: 1
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 1 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: admin@example.com | Authority: 100 | Permissions: [[object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    üì• 2025-12-26T07:55:25.549Z - GET /api/event-requests/REQ-1766735724912-1269

      at log (server.js:142:13)

  console.log
    [ACTION] Created request REQ-1766735725446-5594

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735719062-4467 published for request REQ-1766735723946-3581

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    üì• 2025-12-26T07:55:25.693Z - GET /api/event-requests/REQ-1766735725301-3065

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request routed to reviewer 694aacb51d6c212ee3037d0f

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Request created and assigned to coordinator successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-accepted ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Accept ‚Üí Publish flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [DIAG] getUserPermissions called with userId: 694aacb51d6c212ee3037d0f, type: string

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:106:15)

  console.log
    [DIAG] Converted userId string to ObjectId: 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:129:17)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:137:15)

  console.log
    [ACTION] Testing complete reject ‚Üí finalized flow

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:25.789Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:149:15)

  console.log
    [DIAG] UserRole[0]: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleIdRef: {
        _id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator',
        description: 'Event and request coordinator with review and approval capabilities',
        isSystemRole: true,
        authority: 60,
        permissions: [
          [Object], [Object],
          [Object], [Object],
          [Object], [Object],
          [Object], [Object]
        ],
        createdAt: 2025-12-23T14:22:56.199Z,
        updatedAt: 2025-12-26T07:43:26.510Z,
        __v: 2
      },
      roleIsPopulated: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleCode: 'coordinator',
      roleName: 'Coordinator',
      hasPermissions: true,
      permissionsLength: 8
    }

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:170:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Aggregated 8 permissions from 1 roles

      at PermissionService.log [as getUserPermissions] (src/services/users_services/permission.service.js:193:15)

  console.log
    [ACTOR] Email: patrickkurtv@gmail.com | Authority: 60 | Permissions: [[object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object], [object Object]]

      at TestLogger.log [as logActor] (tests/helpers/logger.js:30:13)

  console.log
    üì• 2025-12-26T07:55:25.946Z - GET /api/event-requests/REQ-1766735725446-5594

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:26.072Z - GET /api/event-requests/REQ-1766735724912-1269/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Stakeholder proposing counter-reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:26.095Z - POST /api/event-requests/REQ-1766735725301-3065/actions

      at log (server.js:142:13)

  console.log
    [requirePermission] SysAdmin bypass: {
      userId: '694aa6556e0113b3849a3e42',
      authority: 100,
      resource: 'request',
      action: 'read'
    }

      at log (src/middleware/requirePermission.js:26:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ACTIONS] Available: [view, accept, reject, reschedule]

      at TestLogger.log [as logActions] (tests/helpers/logger.js:74:13)

  console.log
    [ASSERT] PASS: Actions available: view, accept, reject, reschedule

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.review: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.approve: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    üì• 2025-12-26T07:55:26.505Z - GET /api/event-requests/REQ-1766735725446-5594/actions

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.reject: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.reschedule: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Coordinator has correct actions and permissions

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Coordinator accepting request

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:26.682Z - POST /api/event-requests/REQ-1766735723942-2838/actions

      at log (server.js:142:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    üì• 2025-12-26T07:55:26.690Z - GET /api/event-requests/REQ-1766735725301-3065

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is pending-review

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Coordinator rejecting

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:26.754Z - POST /api/event-requests/REQ-1766735726683-1732/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ACTIONS] Available: [view, accept, reject, reschedule]

      at TestLogger.log [as logActions] (tests/helpers/logger.js:74:13)

  console.log
    [ASSERT] PASS: Actions available: view, accept, reject, reschedule

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.review: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.approve: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Coordinator accepting final reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:27.209Z - POST /api/event-requests/REQ-1766735725301-3065/actions

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Request state is review-accepted

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-accepted

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    üì• 2025-12-26T07:55:27.260Z - GET /api/event-requests/REQ-1766735723942-2838

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.reject: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ASSERT] PASS: Request state is review-rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Stakeholder confirming rejection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:27.366Z - POST /api/event-requests/REQ-1766735726683-1732/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.reschedule: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Admin has correct actions and permissions

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Admin accepting request

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:27.480Z - POST /api/event-requests/REQ-1766735724912-1269/actions

      at log (server.js:142:13)

  console.log
    [ACTIONS] Available: [view, accept, reject, reschedule]

      at TestLogger.log [as logActions] (tests/helpers/logger.js:74:13)

  console.log
    [ASSERT] PASS: Actions available: view, accept, reject, reschedule

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ACTION] Requester confirming acceptance

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:27.658Z - POST /api/event-requests/REQ-1766735723942-2838/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.review: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [RESULT] Coordinator has correct actions and permissions

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [ACTION] Coordinator accepting request

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:27.840Z - POST /api/event-requests/REQ-1766735725446-5594/actions

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Request state is rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rejected ‚Üí rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reject ‚Üí Finalized flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing reschedule loop with multiple iterations

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:27.858Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    üì• 2025-12-26T07:55:27.937Z - GET /api/event-requests/REQ-1766735725301-3065

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is review-accepted

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-accepted

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Coordinator confirming acceptance

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735721025-1040 published for request REQ-1766735723942-2838

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    üì• 2025-12-26T07:55:28.239Z - POST /api/event-requests/REQ-1766735724912-1269/actions

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-accepted ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Accept ‚Üí Publish flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for rejection test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:28.310Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is review-accepted

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [ACTION] Stakeholder confirming

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:28.463Z - POST /api/event-requests/REQ-1766735725301-3065/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [ASSERT] PASS: Request state is review-accepted

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-accepted

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Admin confirming acceptance

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:28.637Z - POST /api/event-requests/REQ-1766735725446-5594/actions

      at log (server.js:142:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [ACTION] First reschedule by coordinator

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:28.828Z - POST /api/event-requests/REQ-1766735728760-3385/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735721970-7598 published for request REQ-1766735724912-1269

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-accepted ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Accept ‚Üí Publish flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for rejection test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:29.062Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735724804-3573 published for request REQ-1766735725301-3065

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [ACTION] Coordinator rejecting request REQ-1766735729162-820

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:29.228Z - POST /api/event-requests/REQ-1766735729162-820/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:29.275Z - GET /api/event-requests/REQ-1766735725301-3065

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735723776-3673 published for request REQ-1766735725446-5594

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rescheduled

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Stakeholder proposing counter-reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:29.442Z - POST /api/event-requests/REQ-1766735728760-3385/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-accepted ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Accept ‚Üí Publish flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for rejection test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:29.515Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [requirePermission] SysAdmin bypass: {
      userId: '694aa6556e0113b3849a3e42',
      authority: 100,
      resource: 'request',
      action: 'create'
    }

      at log (src/middleware/requirePermission.js:26:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Multiple reschedule iterations completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing routing based on requester authority

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:29.790Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [ASSERT] PASS: Request state is review-rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Requester confirming rejection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:29.808Z - POST /api/event-requests/REQ-1766735729162-820/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rescheduled ‚Üí review-rescheduled (iteration 2)

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Coordinator proposing another reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:29.934Z - POST /api/event-requests/REQ-1766735728760-3385/actions

      at log (server.js:142:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aa6556e0113b3849a3e42, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [system-admin]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [ACTION] Admin rejecting request REQ-1766735730177-9712

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:30.263Z - POST /api/event-requests/REQ-1766735730177-9712/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rejected ‚Üí rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reject ‚Üí Finalized flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for reschedule test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:30.301Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rescheduled ‚Üí review-rescheduled (iteration 3)

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Stakeholder confirming final reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:30.539Z - POST /api/event-requests/REQ-1766735728760-3385/actions

      at log (server.js:142:13)

  console.log
    [ACTION] Coordinator rejecting request REQ-1766735730521-6290

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:30.607Z - POST /api/event-requests/REQ-1766735730521-6290/actions

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [ASSERT] PASS: Request state is review-rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Coordinator confirming rejection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:31.034Z - POST /api/event-requests/REQ-1766735730177-9712/actions

      at log (server.js:142:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735727856-6513 published for request REQ-1766735728760-3385

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rescheduled ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reschedule loop with multiple iterations completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing permission edge case

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:31.220Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [ACTION] Coordinator rescheduling request REQ-1766735731188-6890

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:31.252Z - POST /api/event-requests/REQ-1766735731188-6890/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ROUTING] Request assigned to: patrickkurtv@gmail.com (Authority: 60)

      at TestLogger.log [as logRouting] (tests/helpers/logger.js:52:13)

  console.log
    üì• 2025-12-26T07:55:31.301Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Request state is review-rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Admin confirming rejection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    üì• 2025-12-26T07:55:31.398Z - POST /api/event-requests/REQ-1766735730521-6290/actions

      at log (server.js:142:13)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rejected ‚Üí rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reject ‚Üí Finalized flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for reschedule test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    üì• 2025-12-26T07:55:31.653Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rescheduled

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Requester confirming reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:31.836Z - POST /api/event-requests/REQ-1766735731188-6890/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is rejected

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rejected ‚Üí rejected

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reject ‚Üí Finalized flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for reschedule test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:32.040Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [requirePermission] SysAdmin bypass: {
      userId: '694aa6556e0113b3849a3e42',
      authority: 100,
      resource: 'request',
      action: 'create'
    }

      at log (src/middleware/requirePermission.js:26:17)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [RESULT] Permission check working correctly

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing authority mismatch detection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:32.321Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735730296-5970 published for request REQ-1766735731188-6890

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rescheduled ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reschedule ‚Üí Confirm flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Creating new request for multiple reschedule test

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:32.482Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUserRoles called with userId: 694aa6556e0113b3849a3e42, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aa6556e0113b3849a3e42, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aa6556e0113b3849a3e42, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [system-admin]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ACTION] Admin rescheduling request REQ-1766735732750-2554

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:32.834Z - POST /api/event-requests/REQ-1766735732750-2554/actions

      at log (server.js:142:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aa6556e0113b3849a3e42

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [system-admin]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ROUTING] Request assigned to: admin@example.com (Authority: 100)

      at TestLogger.log [as logRouting] (tests/helpers/logger.js:52:13)

  console.log
    [RESULT] Routing based on authority working correctly

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing organization/coverage matching

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:33.097Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [ACTION] Coordinator rescheduling request REQ-1766735733052-970

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:33.140Z - POST /api/event-requests/REQ-1766735733052-970/actions

      at log (server.js:142:13)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [RESULT] Authority hierarchy valid: Reviewer (60) >= Requester (30)

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing organization/coverage match detection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:33.404Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [ACTION] First reschedule iteration

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:33.436Z - POST /api/event-requests/REQ-1766735733369-6736/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rescheduled

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Coordinator confirming reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:33.592Z - POST /api/event-requests/REQ-1766735732750-2554/actions

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [ASSERT] PASS: Request state is review-rescheduled

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] pending-review ‚Üí review-rescheduled

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [ACTION] Admin confirming reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:33.939Z - POST /api/event-requests/REQ-1766735733052-970/actions

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [ACTION] Requester proposing new date

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:34.018Z - POST /api/event-requests/REQ-1766735733369-6736/actions

      at log (server.js:142:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735731649-8817 published for request REQ-1766735732750-2554

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rescheduled ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reschedule ‚Üí Confirm flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [ACTION] Coordinator accepting final reschedule

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:34.496Z - POST /api/event-requests/REQ-1766735733369-6736/actions

      at log (server.js:142:13)

  console.log
    [ASSERT] PASS: Admin authority >= 80

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Authority validation passed

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    ‚úÖ Test database connection closed

      at Object.log (tests/setup/testSetup.js:39:13)

PASS tests/flows/coordinatorToAdmin.test.js (22.65 s)
  Coordinator ‚Üí Admin Flow
    ‚àö 1. Coordinator creates request (5364 ms)
    ‚àö 2. Admin receives request with correct actions (2082 ms)
    ‚àö 3. Admin accepts ‚Üí Request published (1580 ms)
    ‚àö 4. Admin rejects ‚Üí Request finalized (2589 ms)
    ‚àö 5. Admin reschedules ‚Üí Reschedule loop works (2785 ms)
    ‚àö 6. Authority validation - Admin authority >= 80 (74 ms)

  console.log
    [RESULT] Organization match found

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    ‚úÖ Test database connection closed

      at Object.log (tests/setup/testSetup.js:39:13)

PASS tests/integration/requestLifecycle.test.js (22.749 s)
  Request Lifecycle Integration Tests
    ‚àö 1. Complete Accept ‚Üí Publish Flow (6728 ms)
    ‚àö 2. Complete Reject ‚Üí Finalized Flow (2072 ms)
    ‚àö 3. Reschedule Loop with Multiple Iterations (3364 ms)
    ‚àö 4. Permission Edge Case - Coordinator without review permission should fail (1098 ms)
    ‚àö 5. Authority Mismatch Detection (1086 ms)
    ‚àö 6. Missing Organization/Coverage Match Detection (1209 ms)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [EVENT PUBLISHER] Event EVT-1766735732031-4023 published for request REQ-1766735733052-970

      at EventPublisherService.log [as publishEvent] (src/services/eventRequests_services/eventPublisher.service.js:66:15)

  console.log
    [ASSERT] PASS: Request state is approved

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [TRANSITION] review-rescheduled ‚Üí approved

      at TestLogger.log [as logTransition] (tests/helpers/logger.js:85:13)

  console.log
    [RESULT] Reschedule ‚Üí Confirm flow completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [ACTION] Testing admin coordinator selection

      at TestLogger.log [as logAction] (tests/helpers/logger.js:41:13)

  console.log
    üì• 2025-12-26T07:55:34.827Z - POST /api/event-requests

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [requirePermission] SysAdmin bypass: {
      userId: '694aa6556e0113b3849a3e42',
      authority: 100,
      resource: 'request',
      action: 'create'
    }

      at log (src/middleware/requirePermission.js:26:17)

  console.log
    üì• 2025-12-26T07:55:35.074Z - GET /api/event-requests/REQ-1766735733369-6736

      at log (server.js:142:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aa6576e0113b3849a3e79'),
      roleId: new ObjectId('694aa5c06e0113b3849a273e'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 1,
      roleCode: 'system-admin',
      roleName: 'System Administrator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role system-admin (1 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 1,
      permissions: [ '*.*' ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [getUsersWithPermission] Found 2 roles with permission request.review: [
      {
        id: new ObjectId('694aa5c06e0113b3849a273e'),
        code: 'system-admin',
        name: 'System Administrator'
      },
      {
        id: new ObjectId('694aa5c06e0113b3849a2742'),
        code: 'coordinator',
        name: 'Coordinator'
      }
    ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:317:15)

  console.log
    [RESULT] Organization/coverage matching verified

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    ‚úÖ Test database connection closed

      at Object.log (tests/setup/testSetup.js:39:13)

PASS tests/flows/coordinatorStakeholderBidirectional.test.js (23.455 s)
  Coordinator ‚Üî Stakeholder Bidirectional Flow
    ‚àö 1. Coordinator-created request with stakeholder involvement (4104 ms)
    ‚àö 2. Stakeholder-created request escalation to coordinator (1795 ms)
    ‚àö 3. Multiple reschedule iterations between coordinator and stakeholder (4987 ms)
    ‚àö 4. Verify proper routing based on requester authority (3307 ms)
    ‚àö 5. Verify organization/coverage matching for stakeholder requests (2218 ms)

  console.log
    [getUsersWithPermission] Found 2 active UserRole assignments for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:340:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694d7a98e94478ff31e0c20c'),
      roleId: new ObjectId('694aa5c06e0113b3849a274d'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 5,
      roleCode: 'stakeholder',
      roleName: 'Stakeholder'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role stakeholder (5 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 5,
      permissions: [
        'event.create,read',
        'request.create,read,confirm,decline,reschedule',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings',
        'feature.create-event,request-blood'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request state is review-accepted

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Multiple reschedule iterations completed successfully

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    [getUsersWithPermission] Found 1 users with embedded roles for permission request.review

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:366:15)

  console.log
    [DIAG] getUsersWithPermission - Users found with permission request.review: {
      totalUsers: 2,
      usersLogged: 2,
      users: [
        {
          userId: '694aa6556e0113b3849a3e42',
          email: 'admin@example.com',
          name: 'Admin User',
          authority: 100,
          isSystemAdmin: true,
          roles: []
        },
        {
          userId: '694aacb51d6c212ee3037d0f',
          email: 'patrickkurtv@gmail.com',
          name: 'Patrick Villamer',
          authority: 60,
          isSystemAdmin: false,
          roles: [Array]
        }
      ],
      authorityDistribution: {
        systemAdmin: 1,
        operationalAdmin: 0,
        coordinator: 1,
        stakeholder: 0,
        basicUser: 0
      }
    }

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:430:17)

  console.log
    [getUsersWithPermission] Returning 2 unique user IDs for permission request.review (2 from UserRole, 1 from embedded roles): [ '694aa6556e0113b3849a3e42', '694aacb51d6c212ee3037d0f' ]

      at PermissionService.log [as getUsersWithPermission] (src/services/users_services/permission.service.js:446:15)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: User has permission request.review: true

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Permission validation working correctly

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    ‚úÖ Test database connection closed

      at Object.log (tests/setup/testSetup.js:39:13)

PASS tests/flows/stakeholderToCoordinator.test.js (23.744 s)
  Stakeholder ‚Üí Coordinator Flow
    ‚àö 1. Stakeholder creates request (4886 ms)
    ‚àö 2. Coordinator receives request with correct actions (1794 ms)
    ‚àö 3. Coordinator accepts ‚Üí Request published (1628 ms)
    ‚àö 4. Coordinator rejects ‚Üí Request finalized (1985 ms)
    ‚àö 5. Coordinator reschedules ‚Üí Reschedule loop works (2182 ms)
    ‚àö 6. Multiple reschedule iterations (3009 ms)
    ‚àö 7. Permission validation - Coordinator without review permission should fail (120 ms)

  console.log
    [DIAG] getUserRoles called with userId: 694aacb51d6c212ee3037d0f, type: object

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:462:15)

  console.log
    [DIAG] Querying UserRole.find({ userId: 694aacb51d6c212ee3037d0f, isActive: true })

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:471:15)

  console.log
    [DIAG] Found 1 active role assignments for user 694aacb51d6c212ee3037d0f

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:483:15)

  console.log
    [DIAG] Role codes: [coordinator]

      at PermissionService.log [as getUserRoles] (src/services/users_services/permission.service.js:485:17)

  console.log
    [DIAG] aggregatePermissions called with 1 userRoles

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:504:13)

  console.log
    [DIAG] Processing userRole: {
      userRoleId: new ObjectId('694aacb51d6c212ee3037d24'),
      roleId: new ObjectId('694aa5c06e0113b3849a2742'),
      roleType: 'object',
      roleIsObject: true,
      isMongooseDocument: true,
      isObjectId: false,
      hasRole: true,
      hasPermissions: true,
      permissionsCount: 8,
      roleCode: 'coordinator',
      roleName: 'Coordinator'
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:521:15)

  console.log
    [DIAG] Processing permissions from role coordinator (8 permissions)

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:582:15)

  console.log
    [DIAG] aggregatePermissions summary: {
      totalUserRoles: 1,
      processedRoles: 1,
      skippedRoles: 0,
      finalPermissionsCount: 8,
      permissions: [
        'event.create,read,update,approve,publish',
        'request.create,read,review,approve,reject,reschedule,confirm',
        'user.read',
        'location.read',
        'chat.create,read,update,delete',
        'page.campaign,calendar,chat,notification,settings,stakeholder-management',
        'feature.create-event,request-blood,view-reports',
        'staff.read,create,update,delete'
      ]
    }

      at PermissionService.log [as aggregatePermissions] (src/services/users_services/permission.service.js:645:13)

  console.log
    [ASSERT] PASS: Request routed to reviewer 694aacb51d6c212ee3037d0f

      at TestLogger.log [as logAssertion] (tests/helpers/logger.js:121:13)

  console.log
    [RESULT] Admin coordinator selection working correctly

      at TestLogger.log [as logResult] (tests/helpers/logger.js:95:13)

  console.log
    ‚úÖ Test database connection closed

      at Object.log (tests/setup/testSetup.js:39:13)

PASS tests/flows/adminToCoordinator.test.js (24.218 s)
  Admin ‚Üí Coordinator Flow
    ‚àö 1. Admin creates request with coordinator selection (4720 ms)
    ‚àö 2. Coordinator receives request with correct actions (2053 ms)
    ‚àö 3. Coordinator accepts ‚Üí Request published (1678 ms)
    ‚àö 4. Coordinator rejects ‚Üí Request finalized (2519 ms)
    ‚àö 5. Coordinator reschedules ‚Üí Reschedule loop works (2793 ms)
    ‚àö 6. Admin can select any coordinator (1253 ms)

Test Suites: 5 passed, 5 total
Tests:       30 passed, 30 total
Snapshots:   0 total
Time:        24.49 s, estimated 34 s
Ran all test suites.


=== TEST EXECUTION COMPLETE ===
Exit code: 0
